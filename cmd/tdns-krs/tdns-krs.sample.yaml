# Sample configuration file for tdns-krs (Key Receiving Service)
# Copy this to /etc/tdns/tdns-krs.yaml and customize

service:
   name:		TDNS-KRS
   verbose:		true
   debug:		true

log:
   file:		/var/log/tdns/tdns-krs.log

apiserver:
   usetls:		true
   addresses:     	[ 127.0.0.1:8990 ]
   apikey:         	winter-is-coming-santa-stuck-in-chimney
   certfile:		/etc/tdns/certs/localhost.crt
   keyfile:		/etc/tdns/certs/localhost.key

# DNS engine configuration for handling NOTIFY messages
# Note: This is at top level but gets merged into the krs section during parsing
dnsengine:
   addresses:		[ 127.0.0.1:5355, '[::1]:5355' ]  # Addresses to listen on for DNS NOTIFY
   transports:		[ do53 ]  # Transport protocols: do53, dot, doh, doq
   certfile:		/etc/tdns/certs/localhost.crt  # Required for dot, doh, doq
   keyfile:		/etc/tdns/certs/localhost.key  # Required for dot, doh, doq

krs:
   database:
      dsn:		/var/lib/tdns/krs.db  # SQLite database file path
   
   node:
      # Node ID must be a Fully Qualified Domain Name (FQDN) with trailing dot
      # This ID must match exactly the node ID registered in the KDC
      # Example: "cpt.axfr.net." or "node1.example.com."
      id:				cpt.axfr.net.  # Must match node ID in KDC (FQDN with trailing dot)

      # Long-term private keys for decryption (at least one required)
      long_term_hpke_priv_key:	/etc/tdns/krs/cpt.axfr.net.hpke.privatekey  # HPKE (X25519) private key
      long_term_jose_priv_key:	/etc/tdns/krs/cpt.axfr.net.jose.privatekey  # JOSE (P-256) private key

      # KDC public keys for signature verification (optional, enables JWS signature verification)
      kdc_hpke_pubkey:		~/.config/tdns/kdc.hpke.pubkey          # KDC HPKE encryption public key (hex)
      kdc_hpke_signing_pubkey:	~/.config/tdns/kdc.hpke.signing.pubkey  # KDC HPKE signing public key (JWK)
      kdc_jose_pubkey:		~/.config/tdns/kdc.jose.pubkey          # KDC JOSE public key (JWK)

      kdc_address:		127.0.0.1:5354  # KDC server address (IP:port)
   
   control_zone:		kdc.example.com.  # Control zone for KMCTRL records
   
   # use_chunk: If true, use CHUNK format instead of MANIFEST+OLDCHUNK
   # CHUNK is a unified RR type that combines manifest and chunk functionality
   # into a single record type. When enabled, KRS will query for CHUNK records
   # (sequence 0 for manifest, 1+ for data chunks) instead of separate MANIFEST
   # and OLDCHUNK records.
   # Default: false (uses MANIFEST+OLDCHUNK format)
   # Set to true to use the new CHUNK format
   use_chunk:		false  # Set to true to use CHUNK format

   # use_crypto_v2: Enable crypto abstraction layer (v2) for multi-backend support
   # When true: Supports both HPKE and JOSE backends via unified crypto interface
   # When false: Uses direct HPKE implementation (v1, backward compatible)
   # Default: false (uses v1 for backward compatibility)
   use_crypto_v2:	true

   # supported_crypto: List of crypto backends this node supports (for crypto v2)
   # Options: "hpke" (X25519 + AES-256-GCM), "jose" (P-256 + ECDH-ES)
   # The KDC will use the first supported backend that matches the node's capabilities
   supported_crypto:	[ "hpke", "jose" ]

